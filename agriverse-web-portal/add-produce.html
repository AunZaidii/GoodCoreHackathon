<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نیا سامان شامل کریں - AgriVerse</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 sidebar">
                <div class="sidebar-brand">
                    <i class="fas fa-warehouse fa-2x text-success mb-2"></i>
                    <h5 class="text-white">ایگری ورسے</h5>
                    <small class="text-light">گودام مینیجمنٹ</small>
                </div>
                
                <ul class="sidebar-nav">
                    <li><a href="dashboard.html"><i class="fas fa-home"></i> ڈیش بورڈ</a></li>
                    <li><a href="add-produce.html" class="active"><i class="fas fa-plus-circle"></i> نیا سامان درج کریں</a></li>
                    <li><a href="inventory.html"><i class="fas fa-boxes"></i> موجودہ سامان</a></li>
                    <li><a href="release-goods.html"><i class="fas fa-truck-loading"></i> سامان نکالیں</a></li>
                    <li><a href="spoiled-goods.html"><i class="fas fa-trash-alt"></i> خراب مال رپورٹ</a></li>
                    <li><a href="sales.html"><i class="fas fa-chart-bar"></i> فروخت کی تفصیل</a></li>
                    <li><a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> لاگ آؤٹ</a></li>
                </ul>
            </div>

            <!-- Main Content -->
            <div class="col-md-9 main-content">
                <!-- Top Bar -->
                <div class="d-flex justify-content-between align-items-center bg-white p-3 rounded shadow-sm mb-4">
                    <h4 class="mb-0 text-primary">
                        <i class="fas fa-plus-circle me-2"></i>نیا سامان درج کریں
                    </h4>
                    <a href="inventory.html" class="btn btn-outline-primary">
                        <i class="fas fa-arrow-right me-1"></i> سامان دیکھیں
                    </a>
                </div>

                <!-- Add Produce Form -->
                <div class="card">
                    <div class="card-header bg-white">
                        <h5 class="mb-0 text-success">سامان کی تفصیلات</h5>
                    </div>
                    <div class="card-body">
                        <form id="addProduceForm">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="farmerName" class="form-label">کسان کا نام *</label>
                                    <input type="text" class="form-control" id="farmerName" placeholder="کسان کا پورا نام درج کریں" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="farmerPhone" class="form-label">کسان کا فون نمبر *</label>
                                    <input type="tel" class="form-control" id="farmerPhone" placeholder="03XX-XXXXXXX" required>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="productName" class="form-label">پروڈکٹ کا نام *</label>
                                    <select class="form-select" id="productName" required>
                                        <option value="">منتخب کریں</option>
                                        <option value="آلو">آلو</option>
                                        <option value="گندم">گندم</option>
                                        <option value="چاول">چاول</option>
                                        <option value="ٹماٹر">ٹماٹر</option>
                                        <option value="پیاز">پیاز</option>
                                        <option value="دودھ">دودھ</option>
                                        <option value="سبزیاں">سبزیاں</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="quantity" class="form-label">مقدار (کلوگرام) *</label>
                                    <input type="number" class="form-control" id="quantity" placeholder="مثلاً 100" min="1" required>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="pricePerKg" class="form-label">قیمت فی کلو (روپے) *</label>
                                    <input type="number" class="form-control" id="pricePerKg" placeholder="مثلاً 50" min="1" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="quality" class="form-label">معیار *</label>
                                    <select class="form-select" id="quality" required>
                                        <option value="اعلیٰ">اعلیٰ</option>
                                        <option value="درمیانہ" selected>درمیانہ</option>
                                        <option value="عام">عام</option>
                                    </select>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="warehouse" class="form-label">گودام *</label>
                                    <select class="form-select" id="warehouse" required>
                                        <option value="لاہور">لاہور گودام</option>
                                        <option value="فیصل آباد">فیصل آباد گودام</option>
                                        <option value="ملتان">ملتان گودام</option>
                                        <option value="راولپنڈی">راولپنڈی گودام</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="arrivalDate" class="form-label">آمد کی تاریخ *</label>
                                    <input type="date" class="form-control" id="arrivalDate" required>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="notes" class="form-label">اضافی نوٹس</label>
                                <textarea class="form-control" id="notes" rows="3" placeholder="کوئی اضافی معلومات..."></textarea>
                            </div>

                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <button type="reset" class="btn btn-outline-secondary me-md-2">
                                    <i class="fas fa-times"></i> صاف کریں
                                </button>
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-save"></i> سامان محفوظ کریں
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="row mt-4">
                    <div class="col-md-4">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <i class="fas fa-users fa-2x text-primary mb-2"></i>
                                <h5>25+ کسان</h5>
                                <small class="text-muted">رجسٹرڈ</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <i class="fas fa-box fa-2x text-success mb-2"></i>
                                <h5>1,200+ کلو</h5>
                                <small class="text-muted">ماہانہ سامان</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <i class="fas fa-rupee-sign fa-2x text-warning mb-2"></i>
                                <h5>95% ادائیگی</h5>
                                <small class="text-muted">کامیاب ٹرانزیکشن</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
     <script src="js/inventory.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/inventory.js"></script>
    
    <script>
        // Set today's date as default
        document.getElementById('arrivalDate').valueAsDate = new Date();
        
        // Form submission
        document.getElementById('addProduceForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = {
                farmer_name: document.getElementById('farmerName').value,
                farmer_phone: document.getElementById('farmerPhone').value,
                product_name: document.getElementById('productName').value,
                quantity: parseInt(document.getElementById('quantity').value),
                price_per_kg: parseInt(document.getElementById('pricePerKg').value),
                quality: document.getElementById('quality').value,
                warehouse: document.getElementById('warehouse').value,
                arrival_date: document.getElementById('arrivalDate').value,
                notes: document.getElementById('notes').value,
                status: 'available'
            };

            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            
            // Show loading
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> محفوظ ہو رہا ہے...';
            submitBtn.disabled = true;

            try {
                // Simulate API call
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // For demo - store in localStorage
                const existingData = JSON.parse(localStorage.getItem('demoInventory') || '[]');
                existingData.unshift({
                    ...formData,
                    id: Date.now(),
                    created_at: new Date().toISOString()
                });
                localStorage.setItem('demoInventory', JSON.stringify(existingData));
                
                // Show success message
                showAlert('سامان کامیابی سے محفوظ ہو گیا!', 'success');
                
                // Reset form
                this.reset();
                document.getElementById('arrivalDate').valueAsDate = new Date();
                
            } catch (error) {
                showAlert('خرابی: ' + error.message, 'error');
            } finally {
                // Reset button
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        });

        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type === 'success' ? 'success' : 'danger'} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.querySelector('.main-content').prepend(alertDiv);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }
    </script>
    <script>
// Set today's date as default
document.getElementById('arrivalDate').valueAsDate = new Date();

// Form submission handler
document.getElementById('addProduceForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    // Collect form data
    const formData = {
        farmer_name: document.getElementById('farmerName').value,
        farmer_phone: document.getElementById('farmerPhone').value,
        product_name: document.getElementById('productName').value,
        quantity: parseInt(document.getElementById('quantity').value),
        price_per_kg: parseInt(document.getElementById('pricePerKg').value),
        quality: document.getElementById('quality').value,
        warehouse: document.getElementById('warehouse').value,
        arrival_date: document.getElementById('arrivalDate').value,
        notes: document.getElementById('notes').value
    };

    // Validate required fields
    if (!formData.farmer_name || !formData.product_name || !formData.quantity || !formData.price_per_kg) {
        showAlert('براہ کرم تمام ضروری فیلڈز پر کریں', 'error');
        return;
    }

    const submitBtn = this.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    
    // Show loading
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> محفوظ ہو رہا ہے...';
    submitBtn.disabled = true;

    try {
        // Use the inventory function to add produce
        const result = await inventory.addProduce(formData);
        
        // Show success message
        showAlert('سامان کامیابی سے محفوظ ہو گیا!', 'success');
        
        // Reset form
        this.reset();
        document.getElementById('arrivalDate').valueAsDate = new Date();
        
        // Update dashboard stats if we're on dashboard
        if (window.dashboard && window.dashboard.loadDashboardData) {
            window.dashboard.loadDashboardData();
        }
        
    } catch (error) {
        console.error('Error adding produce:', error);
        showAlert('خرابی: ' + error.message, 'error');
    } finally {
        // Reset button
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    }
});

// Alert function
function showAlert(message, type) {
    // Remove existing alerts
    const existingAlerts = document.querySelectorAll('.alert');
    existingAlerts.forEach(alert => alert.remove());
    
    // Create new alert
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type === 'success' ? 'success' : 'danger'} alert-dismissible fade show mt-3`;
    alertDiv.innerHTML = `
        <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-triangle'} me-2"></i>
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    // Insert after the form card
    const formCard = document.querySelector('.card');
    formCard.parentNode.insertBefore(alertDiv, formCard.nextSibling);
    
    // Auto remove after 5 seconds
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.remove();
        }
    }, 5000);
}

// Auto-fill demo data for testing
function fillDemoData() {
    document.getElementById('farmerName').value = 'احمد رضا';
    document.getElementById('farmerPhone').value = '0300-1122334';
    document.getElementById('productName').value = 'آلو';
    document.getElementById('quantity').value = '150';
    document.getElementById('pricePerKg').value = '45';
    document.getElementById('quality').value = 'درمیانہ';
    document.getElementById('warehouse').value = 'لاہور';
    document.getElementById('notes').value = 'تازہ سامان';
    
    showAlert('ڈیمو ڈیٹا بھر دیا گیا ہے۔ اب فارم جمع کرائیں۔', 'info');
}

// Add demo button for testing ()
document.addEventListener('DOMContentLoaded', function() {
    const formActions = document.querySelector('.d-grid');
    if (formActions) {
        const demoBtn = document.createElement('button');
        demoBtn.type = 'button';
        demoBtn.className = 'btn btn-info me-md-2';
        demoBtn.innerHTML = '<i class="fas fa-magic"></i> ڈیمو ڈیٹا';
        demoBtn.onclick = fillDemoData;
        formActions.prepend(demoBtn);
    }
});
</script>
</body>
</html>